
{% extends "base.html" %}

{% block bo_dy %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
<script src="/static/main.js"></script>
<script src="/static/snippet.js"></script>
<script>
var socket = io();

socket.on("open", () => {
  console.log("WebSockets connection established");
});


$(document).ready(() => {
  
  fetch(`/api/messages?TopicId=${getQueryParam("id")}`)
    .then((response) => {
      return response.json();
    })
    .then((jsonData) => {
      jsonData.forEach(element => {
        
        fetch(`/api/user/?UserId=${element.author}`)
          .then((response) => {
            return response.json();
          })
          .then((userData) => {c
            console.log(userData)
            console.log(element)
            $("#Msgs").append(MsgSnippet(userData, element));
          })
          .catch((error) => {
            console.error('Error fetching user data:', error);
          });
      });
    })
    .catch((error) => {
      console.error('Error fetching messages:', error);
    });

});

</script>

<p style="color:red;" id="error"></p>
<form method="POST" enctype="multipart/form-data">
  <label for="Message">Write your message</label>
  <input name="Message" type="text">
  <input name="TopicId" type="hidden" value="">
  <input name="AuthToken" type="hidden" value="">
  <input type="submit" value="Send Message">
</form>

<div class="navigate">
  <span id="TopicInfo"></span>
</div>

<div id="Msgs"></div>

<hr>


{% endblock bo_dy %}
